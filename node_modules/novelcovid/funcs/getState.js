const fetch = require('node-fetch');

module.exports = async function(params) {
    if (!params.state) return await fetch(`https://corona.lmao.ninja/states`).then(r=>r.json());
    else if (!params.state && params.sort) {
        let filteredStates = await fetch(`https://corona.lmao.ninja/states`).then(r=>r.json());
        if (filteredStates.length > 0) filteredStates = filteredStates.sort((a, b) => a[params.sort] + b[params.sort])
        filteredStates = filteredStates.map(x=>x);
        return filteredStates;
    } else if (params.state) {
        let filteredState = await fetch(`https://corona.lmao.ninja/states`).then(r=>r.json());
        filteredState = await filteredState.filter(x=>x.state.toLowerCase() === params.state.toLowerCase());
        if (filteredState.length == 0) throw new TypeError("State could not be found, please make sure that the state you are looking for is in the United States.");
        return filteredState[0];
    }
}